import{e as ge,c as H,o as ee,s as v,a as J,i as dt,p as $,f as Y,b as Rt,d as ut,g as Ae,h as ye,r as mt,j as we,u as se,k as ue,l as Se}from"./utils-Z9pyJ2Ng.js";function K(e=6){const t=document.getElementById("boardArea"),n=document.getElementById("appContainer");if(document.getElementById("board"),!t||!n)return null;const o=window.visualViewport?window.visualViewport.width:window.innerWidth,i=window.visualViewport?window.visualViewport.height:window.innerHeight,a={width:o,height:i,left:0,top:0,right:o,bottom:i},s=t.getBoundingClientRect();n.getBoundingClientRect();const c={titleBar:G("titleBar"),lobbyHeader:G("lobbyHeader"),leaderboard:G("leaderboard"),inputArea:G("inputArea"),keyboard:G("keyboard"),message:G("message",25),messagePopup:G("messagePopup")},l=getComputedStyle(t),r=getComputedStyle(n),m={boardArea:{top:parseFloat(l.marginTop)||0,bottom:parseFloat(l.marginBottom)||0,left:parseFloat(l.marginLeft)||0,right:parseFloat(l.marginRight)||0},appContainer:{top:parseFloat(r.paddingTop)||0,bottom:parseFloat(r.paddingBottom)||0,left:parseFloat(r.paddingLeft)||0,right:parseFloat(r.paddingRight)||0}},d={maxWidth:s.width,maxHeight:Ot(c,m,i),minTileSize:20,maxTileSize:60,targetAspectRatio:5/e,gapRatio:.1},p=Object.values(c).reduce((je,Le)=>je+Le,0),g=m.boardArea.top+m.boardArea.bottom+m.appContainer.top+m.appContainer.bottom,V={width:Math.max(0,s.width-m.boardArea.left-m.boardArea.right),height:Math.max(0,i-p-g-40),totalUIHeight:p,totalMargins:g};return{containerRect:s,viewportRect:a,availableSpace:V,constraints:d,margins:m,elements:c,rows:e,cols:5}}function ae(e){if(!e)return null;const{availableSpace:t,constraints:n,rows:o,cols:i}=e,a=(i-1)*n.gapRatio,s=Math.floor(t.width/(i+a)),c=(o-1)*n.gapRatio,l=Math.floor(t.height/(o+c)),r=Math.min(s,l),m=Math.max(n.minTileSize,Math.min(n.maxTileSize,r)),d=Math.max(2,m*n.gapRatio),p=i*m+(i-1)*d,g=o*m+(o-1)*d;return{tileSize:m,gap:d,boardWidth:p,boardHeight:g,scaleFactor:m/n.maxTileSize,fitsInContainer:p<=t.width&&g<=t.height,constrainedBy:s<l?"width":"height"}}function le(e=6){const t=K(e);if(!t)return{success:!1,error:"Unable to get container info"};const n=ae(t);if(!n)return{success:!1,error:"Unable to calculate optimal sizing"};const{viewportRect:o,elements:i,margins:a}=t,{boardWidth:s,boardHeight:c,tileSize:l}=n,m=s+a.appContainer.left+a.appContainer.right<=o.width,d=Object.values(i).reduce((Le,Mt)=>Le+Mt,0),g=c+d+a.appContainer.top+a.appContainer.bottom+20<=o.height,V=At();return{success:m&&g&&n.fitsInContainer,fitsHorizontally:m,fitsVertically:g,optimalSizing:n,containerInfo:t,elementChecks:V,recommendations:ft(t,n)}}function At(){const e=["board","keyboard","titleBar","leaderboard","inputArea","lobbyHeader","submitGuess"],t={},n=window.visualViewport?window.visualViewport.height:window.innerHeight,o=window.visualViewport?window.visualViewport.width:window.innerWidth;return e.forEach(i=>{const a=document.getElementById(i);if(a){const s=a.getBoundingClientRect();t[i]={exists:!0,visible:s.top>=0&&s.left>=0&&s.bottom<=n&&s.right<=o,partiallyVisible:s.top<n&&s.bottom>0&&s.left<o&&s.right>0,rect:{top:s.top,left:s.left,bottom:s.bottom,right:s.right,width:s.width,height:s.height}}}else t[i]={exists:!1,visible:!1,partiallyVisible:!1}}),t}function ft(e,t){const n=[];t.fitsInContainer||n.push({type:"critical",message:`Board too large for container. Constrained by ${t.constrainedBy}.`,action:"reduce_tile_size",currentSize:t.tileSize,suggestedSize:Math.max(e.constraints.minTileSize,t.tileSize*.8)}),t.tileSize<=e.constraints.minTileSize+5&&n.push({type:"warning",message:"Tiles are very small and may be hard to read/touch.",action:"consider_ui_simplification"}),e.viewportRect.width<400&&n.push({type:"info",message:"Very small screen detected. Consider mobile-optimized layout.",action:"apply_mobile_optimizations"});const o=e.elements.keyboard;return e.availableSpace.height/e.viewportRect.height,o>e.viewportRect.height*.3&&n.push({type:"warning",message:"Keyboard taking up significant screen space.",action:"compress_keyboard"}),n}function be(e=6){const t=le(e);t.success||console.warn("Board scaling verification failed:",t);const{optimalSizing:n}=t;if(!n)return!1;const o=document.documentElement;return o.style.setProperty("--tile-size",`${n.tileSize}px`),o.style.setProperty("--tile-gap",`${n.gap}px`),o.style.setProperty("--board-width",`${n.boardWidth}px`),o.style.setProperty("--ui-scale",`${n.scaleFactor}`),t.recommendations.filter(a=>a.type==="critical"||a.action==="apply_mobile_optimizations").length>0&&_t(n),t.success}function _t(e){const t=document.getElementById("keyboard");if(t&&e.tileSize<35){const n=Math.max(.8,e.tileSize/35);t.style.transform=`scale(${n})`,t.style.transformOrigin="center bottom"}if(e.tileSize<30){const n=document.getElementById("appContainer");n&&(n.style.padding="5px")}}function G(e,t=0){const n=document.getElementById(e);return n?n.offsetHeight:t}function Ot(e,t,n){const o=Object.values(e).reduce((i,a)=>i+a,0)+t.boardArea.top+t.boardArea.bottom+t.appContainer.top+t.appContainer.bottom+40;return Math.max(0,n-o)}function pt(e=[]){const t=[{name:"iPhone SE",width:375,height:667},{name:"iPhone 12",width:390,height:844},{name:"iPhone 12 Pro Max",width:428,height:926},{name:"iPad Mini",width:768,height:1024},{name:"iPad Air",width:820,height:1180},{name:"Galaxy S20",width:360,height:800},{name:"Galaxy Note",width:412,height:915},{name:"Desktop Small",width:1024,height:768},{name:"Desktop Medium",width:1366,height:768},{name:"Desktop Large",width:1920,height:1080}],n=e.length>0?e:t,o=[],i=window.innerWidth,a=window.innerHeight;return n.forEach(s=>{const c=Vt(s.width,s.height,s.name);o.push({device:s.name,dimensions:{width:s.width,height:s.height},...c})}),{testResults:o,summary:Dt(o),originalDimensions:{width:i,height:a}}}function Vt(e,t,n){const o={width:e,height:t},i=K(6);if(!i)return{success:!1,error:"No container info available"};const a={...i,viewportRect:o,availableSpace:{...i.availableSpace,width:Math.min(i.availableSpace.width,e-40),height:Math.max(0,t-i.availableSpace.totalUIHeight-40)}},s=ae(a);if(!s)return{success:!1,error:"Could not calculate optimal sizing"};const c=s.boardWidth<=a.availableSpace.width,l=s.boardHeight<=a.availableSpace.height;return{success:c&&l&&s.tileSize>=20,fitsWidth:c,fitsHeight:l,tileSize:s.tileSize,scaleFactor:s.scaleFactor,boardDimensions:{width:s.boardWidth,height:s.boardHeight},recommendations:ft(a,s)}}function Dt(e){const t=e.length,n=e.filter(s=>s.success).length,o=e.filter(s=>!s.success),i=Math.min(...e.map(s=>s.tileSize||0)),a=Math.max(...e.map(s=>s.tileSize||0));return{total:t,successful:n,failed:o.length,successRate:(n/t*100).toFixed(1)+"%",tileSizeRange:{min:i,max:a},failedDevices:o.map(s=>s.device),recommendations:o.length>0?"Consider implementing responsive breakpoints for failed devices":"All tested devices pass scaling verification"}}function Ht(e,t=6){e.innerHTML="";for(let n=0;n<t*5;n++){const o=document.createElement("div");o.className="tile",o.tabIndex=-1,e.appendChild(o)}}function ht(e,t,n,o=6,i=!1,a=-1,s=null,c=null){const l=t.guesses,r=e.children;for(let d=0;d<o*5;d++)r[d].textContent="",r[d].className="tile";l.forEach((d,p)=>{for(let g=0;g<5;g++){const V=r[p*5+g];V.textContent=d.guess[g].toUpperCase(),V.classList.add(d.result[g]),p===a?V.style.transitionDelay=`${g*.15}s`:V.style.transitionDelay=""}});const m={};if(l.forEach(d=>{for(let p=0;p<5;p++)d.result[p]==="correct"&&(m[p]=d.guess[p])}),!i&&l.length<o){const d=l.length;for(let p=0;p<5;p++){const g=r[d*5+p];g.classList.toggle("hint-target",c===d),s&&s.row===d&&s.col===p?(g.textContent=s.letter.toUpperCase(),g.classList.add("ghost")):p<n.value.length?g.textContent=n.value[p].toUpperCase():m[p]&&(g.textContent=m[p].toUpperCase(),g.classList.add("ghost"))}}}function $t(e){return Array.from(e.children).forEach(n=>n.classList.add("reset-out")),new Promise(n=>setTimeout(n,250))}function Pt(e){return Array.from(e.children).forEach(n=>{n.classList.add("reset-in"),n.addEventListener("animationend",()=>n.classList.remove("reset-in"),{once:!0})}),new Promise(n=>setTimeout(n,250))}function jt(e){Array.from(e.querySelectorAll(".key")).forEach(t=>{t.classList.remove("correct","present","absent")})}function zt(e,t){jt(e);const n={absent:1,present:2,correct:3},o={};t.forEach(i=>{for(let a=0;a<5;a++){const s=i.guess[a].toLowerCase(),c=i.result[a];(!o[s]||n[c]>n[o[s]])&&(o[s]=c)}});for(const i in o){const a=e.querySelector(`.key[data-key="${i}"]`);a&&a.classList.add(o[i])}}function Nt(e){const t=new Set,n={};return e.forEach(o=>{for(let i=0;i<5;i++)o.result[i]==="correct"?(t.add(o.guess[i]),n[i]=o.guess[i]):o.result[i]==="present"&&t.add(o.guess[i])}),{requiredLetters:t,greenPositions:n}}function Gt(e,t,n,o){for(const a in n)if(e[a]!==n[a])return o(`Letter ${n[a].toUpperCase()} must be in position ${Number(a)+1}.`),!1;const i=new Set(e.split(""));for(const a of t)if(!i.has(a))return o(`Guess must contain letter ${a.toUpperCase()}.`),!1;return!0}function Ut(e,t){e.innerHTML="";for(let n=t.length-1;n>=0;n--){const o=t[n],i=document.createElement("li");i.className="history-item";const a=document.createElement("span");a.className="history-emoji",a.textContent=o.emoji;const s=document.createElement("div");s.className="history-guess-tiles";for(let l=0;l<5;l++){const r=document.createElement("div");r.className="tile "+o.result[l],r.textContent=o.guess[l].toUpperCase(),s.appendChild(r)}const c=document.createElement("span");c.className="history-points",c.textContent=(o.points>=0?"+":"")+o.points,i.append(a,s,c),e.appendChild(i)}}async function Ft(e,t){const n=t?`/lobby/${t}/state`:"/state",o=e?`${n}?emoji=${encodeURIComponent(e)}`:n,i=await fetch(o),a=await i.json().catch(()=>({}));if(!i.ok){const s=new Error("HTTP "+i.status);throw s.status=i.status,s.data=a,s}return a}async function Wt(e,t,n,o){const i=o?`/lobby/${o}/guess`:"/guess";return(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guess:e,emoji:t,player_id:n})})).json()}async function qt(e,t){const n=e?`/lobby/${e}/reset`:"/reset";return(await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t?{host_token:t}:{})})).json()}async function _e(e,t,n){const o=n?`/lobby/${n}/emoji`:"/emoji";return(await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:e,player_id:t})})).json()}async function Jt(e,t,n){const o=n?`/lobby/${n}/state`:"/state";return fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:e,player_id:t})})}async function Yt(e,t,n,o){const i=o?`/lobby/${o}/chat`:"/chat";return(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e,emoji:t,player_id:n})})).json()}async function Kt(e,t,n,o){const i=o?`/lobby/${o}/hint`:"/hint";return(await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({col:e,emoji:t,player_id:n})})).json()}async function Xt(e,t,n){const o=`/lobby/${e}/kick`;return(await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({emoji:t,host_token:n})})).json()}function Zt(e,t){if(!window.EventSource)return null;const n=t?`/lobby/${t}/stream`:"/stream",o=new EventSource(n);return o.onmessage=i=>{try{const a=JSON.parse(i.data);e(a)}catch{}},o}const Qt=typeof document<"u"?document.getElementById("emojiModal"):null;ge(Qt);function en(){return localStorage.getItem("myEmoji")||null}function Ee(){return localStorage.getItem("playerId")||null}function tn(e){localStorage.setItem("myEmoji",e)}function Oe(e){e&&localStorage.setItem("playerId",e)}const nn=["ðŸ¶","ðŸ¦Š","ðŸ¼","ðŸ¸","ðŸµ","ðŸ§","ðŸ™","ðŸ¦‰","ðŸ¦„","ðŸ¦","ðŸ¯","ðŸ¨","ðŸ»","ðŸ¦–","ðŸ¦•","ðŸ","ðŸ³","ðŸ¦‹","ðŸ¢","ðŸ¬"];function gt(e,{onChosen:t,skipAutoCloseRef:n,onError:o}){const i=document.getElementById("emojiModal"),a=document.getElementById("emojiChoices"),s=document.getElementById("emojiModalError");a.innerHTML="",nn.forEach(c=>{const l=document.createElement("span");l.className="emoji-choice",l.innerText=c,l.style.opacity=e.includes(c)?.3:1,l.style.pointerEvents=e.includes(c)?"none":"auto",l.onclick=async()=>{const r=await _e(c,Ee(),window.LOBBY_CODE);r.status==="ok"?(r.player_id&&Oe(r.player_id),n&&(n.value=!1),tn(c),typeof t=="function"&&t(c),H(i)):(s.textContent=r.msg||"That emoji is taken.",typeof o=="function"&&o(r.msg))},a.appendChild(l)}),s.textContent="",i.style.display="flex",ee(i)}function on(e,t){t.length<e.childElementCount&&(e.innerHTML="");const n=Math.abs(e.scrollHeight-e.scrollTop-e.clientHeight)<5;for(let o=e.childElementCount;o<t.length;o++){const i=t[o],a=document.createElement("div");a.className="chat-entry";const s=document.createElement("span");s.className="chat-emoji",s.textContent=i.emoji;const c=document.createElement("span");c.className="chat-bubble",c.textContent=i.text,a.append(s,c),e.appendChild(a),requestAnimationFrame(()=>a.classList.add("visible"))}t.length&&n&&(e.scrollTop=e.scrollHeight)}function ze(e,{guessInput:t,submitGuessHandler:n,isAnimating:o},i){if(e.target.classList.contains("key")&&!t.disabled&&!o()){e.preventDefault();const a=e.target.dataset.key,s=t.value;a==="Enter"?n():a==="Backspace"?t.value=s.slice(0,-1):s.length<5&&/^[a-z]$/i.test(a)&&(t.value+=a.toUpperCase()),t.focus(),i()}}function sn({keyboardEl:e,guessInput:t,submitButton:n,submitGuessHandler:o,updateBoardFromTyping:i,isAnimating:a}){e.addEventListener("click",s=>ze(s,{guessInput:t,submitGuessHandler:o,isAnimating:a},i)),e.addEventListener("touchstart",s=>ze(s,{guessInput:t,submitGuessHandler:o,isAnimating:a},i)),n.addEventListener("click",o),t.addEventListener("input",function(){this.value=this.value.replace(/[^a-zA-Z]/g,"").toUpperCase().slice(0,5),i()}),t.addEventListener("keyup",function(s){s.key==="Enter"&&o()}),document.addEventListener("keydown",function(s){if(a()){s.preventDefault();return}const c=document.activeElement;if(t.disabled||c===t||c&&c!==document.body&&(c.tagName==="INPUT"||c.tagName==="TEXTAREA"||c.isContentEditable))return;const l=s.key.toLowerCase(),r=t.value;l==="enter"?(s.preventDefault(),o()):l==="backspace"?(s.preventDefault(),t.value=r.slice(0,-1),i()):r.length<5&&/^[a-z]$/.test(l)&&(s.preventDefault(),t.value+=l.toUpperCase(),i());const m=e.querySelector(`.key[data-key="${l}"]`);m&&(m.classList.add("active-key-press"),setTimeout(()=>m.classList.remove("active-key-press"),150))})}function an(e,t,n,o,i,a=null,s=null){t&&ht(e,t,n,o,i,-1,a,s)}function ln(e,t){e&&(e.style.display=t?"inline":"none")}function W(e,t,n){if(!e)return;const o={row:t,hint:n};localStorage.setItem("hintState-"+e,JSON.stringify(o))}function Ve(e){if(!e)return{row:null,hint:null};const t=localStorage.getItem("hintState-"+e);if(!t)return{row:null,hint:null};try{const n=JSON.parse(t);return{row:n.row!==void 0?n.row:null,hint:n.hint||null}}catch{return{row:null,hint:null}}}const cn="WordSquad",w={MENU:"menu",PLAYING:"playing",PAUSED:"paused",GAME_OVER:"game_over"};class rn{constructor(t=w.MENU){this.current=t}get(){return this.current}set(t){if(!Object.values(w).includes(t))throw new Error(`Invalid state: ${t}`);this.current=t}is(t){return this.current===t}canTransitionTo(t){return({[w.MENU]:[w.PLAYING],[w.PLAYING]:[w.PAUSED,w.GAME_OVER],[w.PAUSED]:[w.PLAYING,w.GAME_OVER],[w.GAME_OVER]:[w.MENU]}[this.current]||[]).includes(t)}transition(t){return this.canTransitionTo(t)?(this.current=t,!0):!1}}function dn(){console.log("ðŸ§ª Running Board Scaling Tests...");const e=le();console.log("ðŸ“Š Current Viewport Verification:",e);const t=pt();console.log("ðŸ“± Device Scaling Tests:",t);const n=K();if(console.log("ðŸ“ Container Information:",n),n){const o=ae(n);console.log("ðŸŽ¯ Optimal Sizing:",o)}return{currentVerification:e,deviceTests:t,containerInfo:n,timestamp:new Date().toISOString()}}function un(){const e=document.getElementById("board"),t=document.getElementById("boardArea"),n=document.getElementById("appContainer");if(e&&t&&n){console.log("ðŸ” Board Debug Measurements:"),console.log("Board rect:",e.getBoundingClientRect()),console.log("Board area rect:",t.getBoundingClientRect()),console.log("App container rect:",n.getBoundingClientRect()),console.log("Viewport:",{width:window.innerWidth,height:window.innerHeight,visualViewport:window.visualViewport?{width:window.visualViewport.width,height:window.visualViewport.height}:"Not available"});const o=document.documentElement,i=getComputedStyle(o);console.log("CSS Variables:",{"--tile-size":i.getPropertyValue("--tile-size"),"--tile-gap":i.getPropertyValue("--tile-gap"),"--board-width":i.getPropertyValue("--board-width"),"--ui-scale":i.getPropertyValue("--ui-scale")})}}function mn(){yt();const e=document.getElementById("boardArea");if(!e)return;const t=document.createElement("div");t.id="debug-container-outline",t.style.cssText=`
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border: 2px dashed #ff6b6b;
    pointer-events: none;
    z-index: 1000;
  `,e.appendChild(t);const n=document.getElementById("board");if(n){const a=document.createElement("div");a.id="debug-board-outline";const s=n.getBoundingClientRect(),c=e.getBoundingClientRect();a.style.cssText=`
      position: absolute;
      left: ${s.left-c.left}px;
      top: ${s.top-c.top}px;
      width: ${s.width}px;
      height: ${s.height}px;
      border: 2px dashed #4ecdc4;
      pointer-events: none;
      z-index: 1001;
    `,e.appendChild(a)}const o=document.createElement("div");o.id="debug-measurements-label",o.style.cssText=`
    position: absolute;
    top: -25px;
    left: 0;
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 4px 8px;
    font-size: 12px;
    border-radius: 4px;
    pointer-events: none;
    z-index: 1002;
  `;const i=K();i&&(o.textContent=`Container: ${Math.round(i.containerRect.width)}Ã—${Math.round(i.containerRect.height)} | Available: ${Math.round(i.availableSpace.width)}Ã—${Math.round(i.availableSpace.height)}`),e.appendChild(o),console.log("âœ¨ Visual debug indicators added. Call removeVisualDebugIndicators() to remove them.")}function yt(){["debug-container-outline","debug-board-outline","debug-measurements-label"].forEach(t=>{const n=document.getElementById(t);n&&n.remove()})}function fn(e,t,n="Custom"){console.log(`ðŸ”¬ Testing viewport size: ${n} (${e}Ã—${t})`);const o=pt([{name:n,width:e,height:t}]);return console.log("Test Results:",o),o}function pn(){console.log("ðŸ‘€ Real-time scaling monitor enabled. Resize window to see updates.");let e;const t=()=>{clearTimeout(e),e=setTimeout(()=>{var i;const n=le(),o=K();if(console.log(`ðŸ“Š Resize Event - Viewport: ${window.innerWidth}Ã—${window.innerHeight}`),console.log("Verification:",n.success?"âœ… PASS":"âŒ FAIL"),!n.success&&n.recommendations&&console.warn("Recommendations:",n.recommendations),o){const a=ae(o);console.log(`Tile size: ${a==null?void 0:a.tileSize}px, Scale: ${(i=a==null?void 0:a.scaleFactor)==null?void 0:i.toFixed(2)}`)}},250)};return window.addEventListener("resize",t),window.addEventListener("orientationchange",t),()=>{window.removeEventListener("resize",t),window.removeEventListener("orientationchange",t),console.log("ðŸ‘‹ Real-time scaling monitor disabled.")}}typeof window<"u"&&(window.boardScalingTests={runBoardScalingTests:dn,debugBoardMeasurements:un,addVisualDebugIndicators:mn,removeVisualDebugIndicators:yt,testSpecificViewportSize:fn,enableRealtimeScalingMonitor:pn,verifyElementsFitInViewport:le,getBoardContainerInfo:K,calculateOptimalTileSize:ae},console.log("ðŸ”§ Board scaling test utilities available at window.boardScalingTests"));const M=new rn;let z=[],Ne=[],me=[],wt={},fe=!1,f=en(),D=Ee(),Ge=!1,xe=!1,Ue=null,ce=!1,j=localStorage.getItem("soundEnabled")==="true",E=null;function bt(){if(!E)try{E=new(window.AudioContext||window.webkitAudioContext)}catch(e){return console.error("Failed to init audio context:",e),j=!1,ne&&(ne.textContent="ðŸ”ˆ Sound Off"),null}return E}function te(){if(E){try{E.close()}catch{}E=null}}const Te=localStorage.getItem("hostToken");let x=6,Et=new Set,vt={},T=null,h=null,b=null,Z=!1;({row:h,hint:b}=Ve(f));const L=document.getElementById("board"),A=document.getElementById("guessInput"),Ct=document.getElementById("submitGuess"),u=document.getElementById("message"),y=document.getElementById("messagePopup"),Lt=document.getElementById("keyboard"),de=document.getElementById("definitionText");document.getElementById("definitionBox");const I=document.getElementById("chatBox"),hn=document.getElementById("chatMessages"),gn=document.getElementById("chatForm"),Fe=document.getElementById("chatInput"),yn=document.getElementById("historyClose"),We=document.getElementById("gameTitle");We&&(We.textContent=cn);const wn=document.getElementById("definitionClose"),bn=document.getElementById("chatClose"),qe=document.getElementById("optionsToggle"),X=document.getElementById("optionsMenu"),En=document.getElementById("optionsClose"),vn=document.getElementById("menuHistory"),Cn=document.getElementById("menuDefinition"),Ln=document.getElementById("menuChat"),De=document.getElementById("menuDarkMode"),ne=document.getElementById("menuSound"),U=document.getElementById("holdReset"),C=document.getElementById("holdResetProgress"),Je=document.getElementById("holdResetText"),k=document.getElementById("boardArea"),_=document.getElementById("historyBox"),Sn=document.getElementById("historyList"),O=document.getElementById("definitionBox"),Ye=document.getElementById("stampContainer"),Q=document.getElementById("hintTooltip"),oe=document.getElementById("closeCallPopup"),Bn=document.getElementById("closeCallText"),xn=document.getElementById("closeCallOk"),He=document.getElementById("titleHintBadge"),Ke=document.getElementById("lobbyCode"),Xe=document.getElementById("playerCount"),Ze=document.getElementById("copyLobbyLink"),Qe=document.getElementById("leaveLobby"),et=document.getElementById("lobbyHeader"),R=document.getElementById("waitingOverlay");let ke=!1;R&&document.addEventListener("click",()=>{R.style.display!=="none"&&(ke=!0,R.classList.add("fade-out"),R.addEventListener("animationend",()=>{R.style.display="none",R.classList.remove("fade-out")},{once:!0}))});oe.style.display="none";const N=document.getElementById("chatNotify"),pe=document.getElementById("infoPopup"),Tn=document.getElementById("infoClose"),kn=document.getElementById("menuInfo"),q=document.getElementById("shareModal"),F=document.getElementById("shareLink"),tt=document.getElementById("shareCopy"),nt=document.getElementById("shareClose"),In=document.getElementById("playerSidebar");document.getElementById("playerList");const ot=document.getElementById("playerToggle"),it=document.getElementById("playerClose");ge(oe);ge(pe);ge(q);let Ie=null;const S=(()=>{const e=window.location.pathname.match(/\/lobby\/([A-Za-z0-9]{6})/);return e?e[1]:null})();window.LOBBY_CODE=S;Ke&&S?Ke.textContent=S:et&&(et.style.display="none");Ze&&S&&Ze.addEventListener("click",()=>{const e=window.location.href;navigator.share?navigator.share({url:e}).catch(()=>{F.value=e,q.style.display="flex",ee(q),F.focus(),F.select()}):(F.value=e,q.style.display="flex",ee(q),F.focus(),F.select())});tt&&tt.addEventListener("click",()=>{navigator.clipboard.writeText(F.value).then(()=>{v("Link copied!",{messageEl:u,messagePopup:y}),J("Lobby link copied")})});nt&&nt.addEventListener("click",()=>{H(q)});Qe&&S&&Qe.addEventListener("click",()=>{if(B){try{B.close()}catch{}B=null}te(),window.location.href="/"});const ie=2e3,st=15e3,Mn=6e4;let St=Date.now(),Be,$e=ie,B=null;dt?(A.readOnly=!0,A.setAttribute("inputmode","none"),A.style.display="none",Ct.style.display="none",u.style.display="none"):u.style.visibility="hidden";function Rn(e){const t=(e>0?"+":"")+e+" point"+(Math.abs(e)!==1?"s":"");dt?(y.textContent=t,y.style.display="block",y.style.animation="fadeInOut 2s",y.addEventListener("animationend",()=>{y.style.display="none",y.style.animation=""},{once:!0})):(u.classList.remove("positive","negative"),e>0&&u.classList.add("positive"),e<0&&u.classList.add("negative"),u.textContent=t,u.style.visibility="visible",u.style.animation="fadeInOut 2s",u.addEventListener("animationend",()=>{u.style.visibility="hidden",u.style.animation="",u.classList.remove("positive","negative")},{once:!0}))}function An(e){Q&&(Q.textContent=e,Q.style.display="block")}function Me(){Q&&(Q.style.display="none")}function _n(e,t){const o=Array.from(L.children)[e*5+t];if(!o)return;const i=k.getBoundingClientRect(),a=o.getBoundingClientRect(),s=a.left-i.left+a.width/2,c=a.top-i.top+a.height/2,l=document.createElement("div");l.className="confetti-container",l.style.left=`${s}px`,l.style.top=`${c}px`,k.appendChild(l);const r=["#f87171","#facc15","#34d399","#60a5fa","#a78bfa"];for(let m=0;m<15;m++){const d=document.createElement("div");d.className="confetti-piece",d.style.backgroundColor=r[m%r.length];const p=(Math.random()-.5)*120,g=-Math.random()*120-30,V=Math.random()*720;d.style.transform="translate(0,0) rotate(0deg)",d.style.opacity="1",d.style.transition="transform 0.8s ease-out, opacity 0.8s",l.appendChild(d),requestAnimationFrame(()=>{d.style.transform=`translate(${p}px, ${g}px) rotate(${V}deg)`,d.style.opacity="0"})}setTimeout(()=>l.remove(),900)}function On(){if(!j||!bt())return;const e=E.createOscillator(),t=E.createGain();e.type="square",e.frequency.setValueAtTime(600,E.currentTime),t.gain.setValueAtTime(.1,E.currentTime),e.connect(t),t.connect(E.destination),e.start(),e.stop(E.currentTime+.05)}function Vn(){if(!j||!bt())return;[523.25,659.25,783.99].forEach((t,n)=>{const o=E.createOscillator(),i=E.createGain();o.type="sine",o.frequency.setValueAtTime(t,E.currentTime+n*.2),i.gain.setValueAtTime(.15,E.currentTime+n*.2),o.connect(i),i.connect(E.destination),o.start(E.currentTime+n*.2),o.stop(E.currentTime+n*.2+.18)}),J("Jingle playing")}function Dn(){N.style.display="block",requestAnimationFrame(()=>N.classList.add("visible")),clearTimeout(Ie),Ie=setTimeout(()=>{N.classList.contains("visible")&&(N.classList.add("wiggle"),N.addEventListener("animationend",()=>{N.classList.remove("wiggle")},{once:!0}))},2e3)}function Bt(){N.classList.remove("visible"),clearTimeout(Ie)}function at(){const e=document.getElementById("leaderboard");if(!xe)if(e.scrollWidth>e.clientWidth){const t=e.querySelector(".leaderboard-entry.me");if(t){const n=t.offsetLeft+t.offsetWidth/2-e.clientWidth/2;e.scrollLeft=n}}else e.scrollLeft=0}function Hn(){const e=document.getElementById("leaderboard");e.innerHTML="";const t=Date.now()/1e3;me.forEach(n=>{const o=document.createElement("span");o.className="leaderboard-entry"+(f===n.emoji?" me":"");const i=wt[n.emoji];(i===void 0||i!==n.score)&&(o.classList.add("flash"),o.addEventListener("animationend",()=>{o.classList.remove("flash")},{once:!0})),n.last_active!==void 0&&t-n.last_active>300&&o.classList.add("inactive");const a=document.createElement("span");if(a.textContent=`${n.emoji} ${n.score}`,o.appendChild(a),n.emoji===f&&(o.style.cursor="pointer",o.title="Click to change your emoji",o.addEventListener("click",()=>{fe=!0;const s=z.filter(c=>c!==f);gt(s,{onChosen:c=>{f=c,D=Ee(),{row:h,hint:b}=Ve(f),P()},skipAutoCloseRef:{value:fe},onError:c=>v(c,{messageEl:u,messagePopup:y})})}),Z)){const s=document.createElement("span");s.className="hint-badge",s.textContent="ðŸ” x1",o.appendChild(s)}e.appendChild(o)}),at(),e.onscroll=()=>{xe=!0,clearTimeout(Ue),Ue=setTimeout(()=>{xe=!1,at()},1e3)}}function $n(){const e=document.getElementById("playerList");if(!e)return;e.innerHTML="";const t=Date.now()/1e3;me.forEach(n=>{const o=document.createElement("li");if(o.className="player-row",n.last_active!==void 0&&t-n.last_active>300&&o.classList.add("inactive"),o.textContent=`${n.emoji} ${n.score}`,Te&&n.emoji!==f){const i=document.createElement("button");i.textContent="Kick",i.addEventListener("click",()=>{Xt(S,n.emoji,Te).then(P)}),o.appendChild(i)}e.appendChild(o)})}function ve(e){if(Ye.innerHTML="",document.body.dataset.mode!=="medium")return;const t=L.getBoundingClientRect();e.forEach((n,o)=>{const i=L.children[o*5];if(!i)return;const s=i.getBoundingClientRect().top-t.top+i.offsetHeight/2,c=document.createElement("span");c.className="board-stamp",c.textContent=n.emoji,c.style.top=`${s}px`,Ye.appendChild(c)})}async function xt(){typeof te=="function"&&te(),await $t(L);const e=await qt(S,Te);return!e||e.status!=="ok"?(e&&e.msg&&v(e.msg,{messageEl:u,messagePopup:y}),e):(await P(),await Pt(L),v("Game reset!",{messageEl:u,messagePopup:y}),e)}async function Pn(){if(await P(),!T.is_over){v("Board already reset.",{messageEl:u,messagePopup:y});return}return await xt()}function jn(){M.is(w.GAME_OVER)?(Je.textContent="Reset",C.style.width="0%",C.style.opacity="0",U.onmousedown=null,U.ontouchstart=null,U.onclick=()=>{Pn()}):(Je.textContent="Reset",C.style.opacity="0.9",U.onclick=null,U.onmousedown=lt,U.ontouchstart=e=>{e.preventDefault(),lt()})}let Re=null;function lt(){let e=0;const t=2e3;C.style.width="0%",C.style.transition="none",C.style.opacity="0.9",C.style.background="var(--absent-shadow-light)",Re=setInterval(()=>{e+=20;const n=Math.min(e/t,1)*100;C.style.width=n+"%",e>=t&&(clearInterval(Re),C.style.width="100%",C.style.opacity="0.95",C.style.background="var(--correct-shadow-light)",setTimeout(()=>{C.style.width="0%"},350),xt())},20)}function zn(){clearInterval(Re),C.style.transition="width 0.15s",C.style.width="0%",C.style.opacity="0.9"}["mouseup","mouseleave","touchend","touchcancel"].forEach(e=>U.addEventListener(e,zn));function Pe(e){const t=T?T.guesses.length:0,n=T&&T.chat_messages?T.chat_messages.length:0;T=e,Ne=z.slice(),wt=Object.fromEntries(me.map(l=>[l.emoji,l.score])),z=e.active_emojis||[],me=e.leaderboard||[],Z=!!e.daily_double_available,Z&&e.guesses.length===0?(h=0,b=null,W(f,h,b)):!Z&&e.guesses.length===0&&h!==null&&(h=null,b=null,W(f,h,b)),f&&Ne.includes(f)&&!z.includes(f)&&v("You were removed from the lobby.",{messageEl:u,messagePopup:y}),Xe&&(Xe.textContent=`${z.length} player${z.length!==1?"s":""}`),R&&(e.phase!=="waiting"&&(ke=!1),e.phase==="waiting"&&!ke?(R.classList.remove("fade-out"),R.style.display="flex"):R.classList.contains("fade-out")||(R.style.display="none")),Hn(),$n(),ln(He,Z),e.chat_messages&&(on(hn,e.chat_messages),e.chat_messages.length>n&&!document.body.classList.contains("chat-open")&&Dn());const o=[];e.past_games&&e.past_games.forEach(l=>l.forEach(r=>o.push(r))),o.push(...e.guesses),Ut(Sn,o),x=e.max_rows||6;const i=e.guesses.length>t?e.guesses.length-1:-1;if(ht(L,e,A,x,M.is(w.GAME_OVER),i,b,h),h!==null&&e.guesses.length>h&&(h=null,b=null,Me(),ue(M.is(w.GAME_OVER)),W(f,h,b)),b&&e.guesses.length>b.row&&(b=null,W(f,h,b)),i>=0)for(let l=0;l<5;l++)setTimeout(On,l*150);ve(e.guesses),zt(Lt,e.guesses);const a=Nt(e.guesses);Et=a.requiredLetters,vt=a.greenPositions;const s=M.is(w.GAME_OVER);if(e.is_over?M.transition(w.GAME_OVER):M.is(w.GAME_OVER)&&M.transition(w.PLAYING),ue(M.is(w.GAME_OVER)||h!==null),jn(),e.is_over){const l=e.definition||"Definition not found.";de.textContent=`${e.target_word.toUpperCase()} â€“ ${l}`}else if(e.last_word){const l=e.last_definition||"Definition not found.";de.textContent=`${e.last_word.toUpperCase()} â€“ ${l}`}else de.textContent="";$(k,_,O,I),!s&&e.is_over;const c=z.includes(f);!f||!c||Ge?(gt(z,{onChosen:l=>{f=l,D=Ee(),{row:h,hint:b}=Ve(f),P()},skipAutoCloseRef:{value:fe},onError:l=>v(l,{messageEl:u,messagePopup:y})}),Ge=!1):fe||H(document.getElementById("emojiModal"))}async function P(){try{const e=await Ft(f,S);ce&&v("Reconnected to server.",{messageEl:u,messagePopup:y}),ce=!1,Pe(e)}catch(e){if(console.error("fetchState error:",e),e&&e.status===404){v("This lobby has expired or was closed.",{messageEl:u,messagePopup:y}),setTimeout(()=>{window.location.href="/"},3e3);return}ce||(v("Connection lost. Retrying...",{messageEl:u,messagePopup:y}),ce=!0)}}async function Nn(){if(M.is(w.GAME_OVER))return;const e=A.value.trim().toLowerCase();if(e.length!==5){Se(A),v("Please enter a 5-letter word.",{messageEl:u,messagePopup:y});return}if(!Gt(e,Et,vt,n=>v(n,{messageEl:u,messagePopup:y}))){Se(A);return}if(!D)try{const n=await _e(f,null,S);n&&n.player_id&&(D=n.player_id,Oe(n.player_id))}catch{}const t=await Wt(e,f,D,S);if(A.value="",t.status==="ok"){if(Pe(t.state),t.daily_double&&(t.daily_double_tile&&_n(t.daily_double_tile.row,t.daily_double_tile.col),h=t.state.guesses.length,b=null,ue(!0),W(f,h,b),v("Daily Double! Tap a tile in the next row for a hint.",{messageEl:u,messagePopup:y}),An("Tap a tile in the next row to reveal a letter!"),J("Daily Double earned â€“ choose one tile in the next row to preview.")),typeof t.pointsDelta=="number"&&Rn(t.pointsDelta),t.won&&(v("You got it! The word was "+t.state.target_word.toUpperCase(),{messageEl:u,messagePopup:y}),Vn()),t.over&&!t.won&&v("Game Over! The word was "+t.state.target_word.toUpperCase(),{messageEl:u,messagePopup:y}),t.over){const n=t.state.definition||"Definition not found.";de.textContent=`${t.state.target_word.toUpperCase()} â€“ ${n}`,$(k,_,O,I)}}else t.close_call?(Bn.textContent=`Close call! ${t.close_call.winner} beat you by ${t.close_call.delta_ms}ms.`,oe.style.display="flex",ee(oe)):v(t.msg,{messageEl:u,messagePopup:y}),Se(A)}function Tt(){St=Date.now(),!B&&$e!==ie&&he(ie),Jt(f,D,S),P()}function he(e){Be&&clearInterval(Be),Be=setInterval(P,e),$e=e}function Gn(){!B&&Date.now()-St>Mn&&$e!==st&&he(st)}function Un(){B=Zt(e=>{Pe(e)},S),B?B.onerror=()=>{B.close(),B=null,he(ie)}:he(ie)}function Ce(e){document.body.dataset.mode==="medium"&&["history-open","definition-open","chat-open","info-open"].forEach(t=>{t!==e&&document.body.classList.remove(t)}),document.body.classList.toggle(e),$(k,_,O,I)}sn({keyboardEl:Lt,guessInput:A,submitButton:Ct,submitGuessHandler:Nn,updateBoardFromTyping:()=>an(L,T,A,x,M.is(w.GAME_OVER),b,h),isAnimating:()=>!1});function Fn(){const e=document.body.classList.toggle("dark-mode");localStorage.setItem("darkMode",e),ut(De)}function Wn(){j=!j,localStorage.setItem("soundEnabled",j),ne.textContent=j?"ðŸ”Š Sound On":"ðŸ”ˆ Sound Off",j||te()}function qn(){Ce("history-open"),document.body.classList.contains("history-open")&&Y(_)}function Jn(){Ce("definition-open"),document.body.classList.contains("definition-open")&&Y(O)}function Yn(){pe.style.display="flex",ee(pe)}function kt(){if(h===null)return;const e=document.body.classList.toggle("hint-selecting");Array.from(L.children).forEach((n,o)=>{const i=Math.floor(o/5);n.tabIndex=e&&i===h?0:-1}),e?(Y(L),J("Hint selection active. Use arrow keys to choose a tile, then press Enter.")):J("Hint selection canceled.")}yn.addEventListener("click",()=>{document.body.classList.remove("history-open"),$(k,_,O,I)});wn.addEventListener("click",()=>{document.body.classList.remove("definition-open"),$(k,_,O,I)});bn.addEventListener("click",()=>{document.body.classList.remove("chat-open"),$(k,_,O,I)});N.addEventListener("click",()=>{Ce("chat-open"),Bt(),document.body.classList.contains("chat-open")&&Y(I)});qe.addEventListener("click",()=>{Rt(X,qe)});En.addEventListener("click",()=>{H(X)});vn.addEventListener("click",()=>{qn(),H(X)});Cn.addEventListener("click",()=>{Jn(),H(X)});Ln.addEventListener("click",()=>{Ce("chat-open"),Bt(),document.body.classList.contains("chat-open")&&Y(I),H(X)});kn.addEventListener("click",()=>{Yn(),H(X)});De.addEventListener("click",Fn);ne.addEventListener("click",Wn);xn.addEventListener("click",()=>{H(oe)});Tn.addEventListener("click",()=>{H(pe)});He.addEventListener("click",kt);He.addEventListener("keydown",e=>{(e.key===" "||e.key==="Enter")&&(e.preventDefault(),kt())});ot&&ot.addEventListener("click",()=>{document.body.classList.toggle("players-open"),document.body.classList.contains("players-open")&&Y(In)});it&&it.addEventListener("click",()=>{document.body.classList.remove("players-open")});ut(De);ne.textContent=j?"ðŸ”Š Sound On":"ðŸ”ˆ Sound Off";Ae();Ht(L,x);const Kn=be(x);Kn||ye(x);const re=le(x);var rt;re.success||(console.warn("Board scaling verification failed:",re),((rt=re.recommendations)==null?void 0:rt.length)>0&&console.info("Scaling recommendations:",re.recommendations));mt();$(k,_,O,I);ve([]);f&&_e(f,D,S).then(e=>{e.player_id&&(D=e.player_id,Oe(e.player_id))}).catch(()=>{});window.innerWidth>900&&(document.body.classList.add("history-open"),document.body.classList.add("definition-open"),$(k,_,O,I));P();Un();setInterval(Gn,5e3);document.addEventListener("keydown",Tt);document.addEventListener("click",Tt);window.addEventListener("resize",()=>{mt(),$(k,_,O,I),Ae(),be(x)||ye(x),we(),T&&ve(T.guesses)});se();window.addEventListener("resize",se);window.visualViewport&&window.visualViewport.addEventListener("resize",()=>{se(),we()});window.addEventListener("orientationchange",()=>{se(),$(k,_,O,I),Ae(),be(x)||ye(x),we(),T&&ve(T.guesses)});let ct;window.addEventListener("orientationchange",()=>{clearTimeout(ct),ct=setTimeout(()=>{se(),be(x)||ye(x),we()},300)});async function It(e){Me();const t=await Kt(e,f,D,S);t.status==="ok"?(b={row:t.row,col:t.col,letter:t.letter},h=null,document.body.classList.remove("hint-selecting"),Array.from(L.children).forEach(n=>n.tabIndex=-1),ue(M.is(w.GAME_OVER)),W(f,h,b),Me(),v(`Hint applied â€“ the letter '${t.letter.toUpperCase()}' is shown only to you.`,{messageEl:u,messagePopup:y}),J(`Hint applied â€“ the letter '${t.letter.toUpperCase()}' is shown only to you.`),P()):t.msg&&v(t.msg,{messageEl:u,messagePopup:y})}L.addEventListener("click",async e=>{if(h===null)return;const t=e.target.closest(".tile");if(!t)return;const o=Array.from(L.children).indexOf(t);if(o===-1)return;const i=Math.floor(o/5),a=o%5;i===h&&await It(a)});L.addEventListener("keydown",async e=>{if(!document.body.classList.contains("hint-selecting"))return;const t=Array.from(L.children).slice(h*5,h*5+5);let n=t.indexOf(document.activeElement);n===-1&&(n=0),e.key==="ArrowLeft"?(e.preventDefault(),t[(n+4)%5].focus()):e.key==="ArrowRight"?(e.preventDefault(),t[(n+1)%5].focus()):e.key==="Enter"||e.key===" "?(e.preventDefault(),await It(n)):e.key==="Escape"&&(e.preventDefault(),document.body.classList.remove("hint-selecting"),t.forEach(o=>o.tabIndex=-1))});gn.addEventListener("submit",async e=>{e.preventDefault();const t=Fe.value.trim();t&&(Fe.value="",await Yt(t,f,D,S),P())});window.addEventListener("beforeunload",()=>{if(B){try{B.close()}catch{}B=null}te()});
